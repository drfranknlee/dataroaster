#######################################################################
# Name        : crt_spongebob_vol.yml
# Creator     : L.S.H.
# Syntax      : None, just be called by main playbook 
# Description : Create VM on Azure & Be included from crt_spongebob.yml
#######################################################################
---
- name: Create the "{{ vg_name }}" Volume group.
  lvg:
    pvs: "{{ raw_disks }}"
    vg: "{{ vg_name }}"
    pesize: "8"
    pv_options: '-Z y'
    force: yes
    state: present

- name: Create the "{{ lv_name }}" Logical Volume.
  lvol:
    vg: "{{ vg_name }}"
    lv: "{{ lv_name }}"
    size: "{{ require_lv_size }}"
    active: yes
    force: no
    state: present

- name: Create a "{{ fs }}" filesystem on lvm "/dev/mapper/{{ vg_name}}-{{ lv_name}}".
  filesystem:
    fstype: "{{ fs }}"
    dev: "/dev/mapper/{{ vg_name }}-{{ lv_name }}"
    force: no

- name: Create a directory to mount the filesystem.
  file:
    path: "{{ mount_point }}"
    state: directory
    mode: '0755'

- name: Mount the created "{{ fs }}" filesystem.
  mount:
    path: "{{ mount_point }}"
    src: "/dev/mapper/{{ vg_name}}-{{ lv_name}}"
    fstype: "{{ fs }}"
    opts: rw,nosuid,noexec
    state: mounted

